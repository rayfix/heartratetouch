<!doctype html>
<html class="no-js" lang="en" xmlns="http://www.w3.org/1999/xhtml" xmlns:og="http://ogp.me/ns#" xmlns:fb="https://www.facebook.com/2008/fbml">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" type="image/x-icon" href="http://pelfunc.com/favicon.ico?v=2" />
    <!-- Use title if it's in the page YAML frontmatter -->
    <title>Investigating Accuracy</title>
    
    
    <link href="/stylesheets/app.css" rel="stylesheet" type="text/css" /><link href="/stylesheets/style.css" rel="stylesheet" type="text/css" />
    <script src="/javascripts/modernizr.js" type="text/javascript"></script>

    <!-- Facebook SEO -->
    <meta property="og:title" content="Heart Rate Touch"/>
    <meta property="og:type" content="article"/>
    <meta property="og:url" content="http://heartratetouch.com/"/>
    <meta property="og:image" content="http://heartratetouch.com/images/three2048.png"/>
    <meta property="og:site_name" content="Heart Rate Touch"/>
    <meta property="og:description" content="Heart Rate Touch measures your pulse simply and accurately while respecting your privacy. No logins, in-app purchases or other up-sell gimmicks."/>
 
  </head>
  
  <body class="blog blog_2014 blog_2014_12 blog_2014_12_29 blog_2014_12_29_accuracy blog_2014_12_29_accuracy_index">
  <div class="off-canvas-wrap wrapper" data-offcanvas>
    <div class="inner-wrap">
      <nav class="tab-bar hide-for-medium-up">
        <section class="left-small">
          <a class="left-off-canvas-toggle menu-icon" href="#"><span id="menu-indent">Menu</span></a>
        </section>
      </nav>
      <aside class="left-off-canvas-menu">
        <ul class="off-canvas-list">
              <li><a href="../../../../../">Home</a></li>
    <li><a href="/about">About</a></li>
    <li><a href="/blog">Blog</a></li>
    <li><a href="/faq">FAQ</a></li>
    <li><a href="/privacy">Privacy</a>
    <li><a href="/contact">Contact</a></li>
        </ul>
      </aside>
      <a class="exit-off-canvas"></a>

      <div class="show-for-medium-up contain-to-grid">
        <nav class="top-bar show-for-medium-up" data-topbar>
          <ul class="title-area">
            <li class="name"><a href="/index.html"><img width="35" height="35" style="padding-top: 10px; padding-left: 10px; opacity: 0.85;" src="/images/pelfunc_grid_white.png" alt="Pelfunc Grid Symbol"></a></li>
            <li class="toggle-topbar menu-icon"><a href="#">Menu</a></li>
          </ul>
          <section class="top-bar-section right">
            <ul>
                  <li><a href="../../../../../">Home</a></li>
    <li><a href="/about">About</a></li>
    <li><a href="/blog">Blog</a></li>
    <li><a href="/faq">FAQ</a></li>
    <li><a href="/privacy">Privacy</a>
    <li><a href="/contact">Contact</a></li>
            </ul>
          </section>
        </nav>
      </div>

    <main>
        <div class="row">
    <div class="small-8 columns">
  <h2>Investigating Accuracy</h2>
  <p><aside><b>December 29, 2014</b></aside></p>
  <article>
  <p>One the the primary goals of Heart Rate Touch is to produce the most accurate answers possible.  Accuracy degrades with sensor noise, user motion, pulse irregularities, numerical errors, and, of course, software bugs.  This blog post is a little bit technical, but shows how we quantified and improved our accuracy before we released 1.0.  TL;DR It's pretty good.</p>

<p></p>

<p>The best way to gain confidence in software is to test, and with a little design you can make your software readily testable.  Synthetic image testing is an approach you simulate image inputs from a known value. You can measure the actual output and compare it with the expected output.  For Heart Rate Touch, it looks like this:</p>

<p><img alt="Sythetic Testing" width="264" height="515" src="/images/blog/synth.png" /></p>

<p>The green boxes above are test code where the red box is the actual production algorithm.  (Incidentally, this is why you want to make your code modular.  It lets you build interesting variations on your original work easily.)  In the above example we generate images pulsing at 62 bpm.  When we put it into the actual algorithm, it measures 63.1 bpm which means the error is 1.1 bpm.  Why not zero?  After some investigation we determined that error was coming from quantization error.  Our algorithm does frequency analysis much like a graphic equalizer does on your stereo.  The more bands you break your signal into the higher accuracy you get but the slower runs, so there is a speed accuracy tradeoff.</p>

<p>If we sweep over the entire operating range from 40 to 200 bpm, and simply pick the biggest frequency value, an interesting error pattern emerges.</p>

<p><img alt="No Fit" width="1880" height="960" src="/images/blog/no_fit.png" /></p>

<p>A couple of things to notice here: (1) the error can get quite large, (2) the error is periodic and (3) sometimes, for certain rates, the error is zero. What causes this error?  When the peak frequency is spread across multiple frequency bands, there will be error.  We can quantify the error by adding up all of the errors, squaring them and then taking their square root.  This is known as <a href="http://en.wikipedia.org/wiki/Root-mean-square_deviation">Root Mean Squared Error (RMSE)</a> and ensures that positive and negative errors don't cancel each other out.  In this case the RMS Error is 2.01 bpm.</p>

<p>A simple possible improvement for this is to fit data from multiple frequency bands.  For example, if the strength of frequency band 10 and band 11 have equal values, we can conclude that the true peak is actually closer to 10.5.  We can use even more bands and do a simple fit. Doing so reduces the error by almost half with a 1.18 RMS error.</p>

<p><img alt="Simple Fit" width="1862" height="994" src="/images/blog/simple_fit.png" /></p>

<p>Can we do better?  To reduce error further we could double or triple the number of frequency bands we use.  This would add delay the first measurement.  Rather than incur this penalty, we came up a better solution. Using the rough peak frequency band as a robust initial estimate, HRT operates on the original signal to compute a very precise fit.  The RMS Error drops to an astounding 0.05 bpm.</p>

<p><img alt="HRT Fit" width="1850" height="1006" src="/images/blog/hrt_fit.png" /></p>

<p>We are very happy with this result. (We have observed that some of our competitors have no where near this accuracy, being closer to the no-fit, naive solution.)</p>

<p><img alt="Summary of Error" width="1784" height="936" src="/images/blog/summary.png" /></p>

<p>Synthetic tests are great, but they only test part of the system.  How does it work in the real world?  We compared Heart Rate Touch against the <a href="http://www.polar.com/us-en/products/get_active/fitness_crosstraining/FT7">Polar FT7 with H1 cheststrap sensor</a> and found good agreement.  First we measured at a resting rate:</p>

<p><img alt="Sanjay Resting" width="1024" height="951" src="/images/blog/hrt55.jpg" /></p>

<p>After playing an hour of <a href="http://en.wikipedia.org/wiki/Ultimate_(sport)">Ultimate Frisbee</a>, we then measured again.  This time the heart rate was double the value but still tracking well.</p>

<p><img alt="Sanjay after Ultimate" width="1024" height="705" src="/images/blog/hrt105.jpg" /></p>

<h4 id="future-work">Future Work</h4>

<p>We are quite pleased with the performance of 1.0 but that doesn't mean there isn't room for improvement.  When the user moves or the pulse is irregular, it can sometimes result in an incorrect measurement.  We are studying these problems and ways to address them.  We look forward to being able to roll out these improvements in future releases and blog about them.  Speaking of which, if you are interested in testing early beta versions, reach out to us at <a href="mailto:hrt@pelfunc.com">hrt@pelfunc.com</a>.  We can't guarantee that you will get a spot, but we would love to hear from you.</p>

  </article>
    </div>
    <div class="small-4 columns">

    <div class="topspace">     
    <a href="https://itunes.apple.com/us/app/heart-rate-touch/id945121083"><img src="/images/DownloadOnAppStore.png" alt="Download on App Store" width="160px"></a>
    </div>

    <div class="topspace">
    <img src="/images/three440.png" width="220px" alt="Picture of iPhones running Heart Rate Touch" />
    </div>

</div>
  </div>

    </main>
    </div> <!-- inner wrap -->
  </div> <!-- off canvas -->
  <script src="/javascripts/all.js" type="text/javascript"></script>

    <footer>
      <div class="row">
        <div class="large-offset-6 large-6 columns">      
          <div class="topspace right">&copy; Pelfunc Inc., 2014-2015.</div>
        </div>
      </div>
    </footer>
    

  </body>
</html>